/Users/glori/anaconda3/lib/python3.11/site-packages/pandas/core/arrays/masked.py:60: UserWarning: Pandas requires version '1.3.6' or newer of 'bottleneck' (version '1.3.5' currently installed).
  from pandas.core import (
    ⚠️  ICPMP requested 8 employees, but only 6 available
[CLI] Applying resource limits (75% system RAM)...
[ResourceLimiter] Applying resource limits...
  System: 32.0 GB RAM, 12 CPUs
[ResourceLimiter] ⚠️  Could not set memory limit: current limit exceeds maximum limit
[ResourceLimiter] ✓ Resource limits applied
[CLI] Using unified solver
[CLI] ======================================================================
[CLI] ICPMP v3.0 PREPROCESSING (demandBased mode)
[CLI] ======================================================================
[CLI] Input: 6 employees, 0 have patterns
  ✓ 8 employees: FEASIBLE!
[CLI] ✓ ICPMP preprocessing completed
[CLI] ✓ Filtered: 6 → 6 employees
[CLI] ✓ Utilization: 100.0%
[CLI] ✓ Time: 0.00s

[CLI] ======================================================================
[CLI] USING ICPMP-ASSIGNED OFFSETS
[CLI] ======================================================================
[CLI] ✓ ICPMP assigned rotation offsets to 6 employees
[CLI] ℹ️  Skipping auto-staggering to preserve ICPMP's optimal offset distribution

[CLI] ╔════════════════════════════════════════════════════════════
[CLI] ║ DEBUG: RAW INPUT EMPLOYEES - BEFORE load_input()
[CLI] ╠════════════════════════════════════════════════════════════
[CLI] ║ Total raw employees: 6
[CLI] ║ First 3 raw employees:
[CLI] ║   00173519: rotationOffset=0, ouId=PB T1 A1
[CLI] ║   00173565: rotationOffset=0, ouId=PB T1 A2
[CLI] ║   00173697: rotationOffset=1, ouId=PB T1 A3
[CLI] ╚════════════════════════════════════════════════════════════
[CLI] Loading input into solver context...
[CLI] ℹ️  Stored 6 ICPMP offsets in context for output builder
[CLI] Starting CP-SAT solver...

================================================================================
[SOLVER STARTING]
================================================================================


[slot_builder] Expanding demands into slots...
  Planning horizon: 2026-06-01 to 2026-06-30
  Public holidays: []
  Demand DI-2512310229-81202335: base=2026-06-01, location=LOC-PT1RBS-9318
    Shift #0: coverage_days=['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'], includePH=True, includeEvePH=True
      Requirement 271_1: product=AVSO, ranks=['ASO', 'AVSP', 'SASS'], gender=Any, scheme=P
        Headcount (legacy): 1 per shift
        Work Pattern: ['D', 'D', 'N', 'N', 'O', 'O']
        Creating slots for shift codes from workPattern: ['D', 'N']
        Creating 1 position(s) for shift D
        Shift D, Position 0: Created 30 slots
        Creating 1 position(s) for shift N
        Shift N, Position 0: Created 30 slots
[slot_builder] ✓ Expanded to 60 total slots

[build_model] Creating decision variables...
  Slots: 60
  Employees: 6
  Cached: 6 employees, 30 dates
[build_model] ✓ Created 360 decision variables
  ℹ️  Work pattern enforcement will be handled as hard constraints

[build_model] Creating unassigned slot variables...
  ✓ Created 60 unassigned slot variables

[build_model] Adding headcount constraints (with unassigned option)...
  ✓ Added 60 headcount constraints (allowing unassigned)

[build_model] Adding one-per-day constraints...
  ✓ Added 180 one-per-day constraints

[build_model] Creating total unassigned counter...
  ✓ Created total_unassigned variable (range: 0-60)

[build_model] Optimization Mode: minimizeEmployeeCount
  Max employees to use: 6
  ✓ Hard limit: Use at most 6 employees
  ✓ Objective: Minimize employee count (use fewest employees)

  ✓ Using fixed rotation offsets from employee data

[build_model] Adding work pattern constraints...
  ✓ Added 240 work pattern constraints (HARD, all fixed offsets)

[build_model] STRICT adherence constraints REMOVED - all employees flexible within pattern
  ℹ️  Employees can work any 'D' day that matches their rotation offset
  ℹ️  Weekly/monthly hour caps will naturally limit assignments

[build_model] TEMPORARILY DISABLED - testing without continuity constraints...
  ⚠️  CONTINUITY CONSTRAINTS DISABLED

[build_model] TEMPORARILY DISABLED - testing without anchor preferences...
  ⚠️  ANCHOR PREFERENCES DISABLED

  ✓ No anchor preferences needed

[build_model] Adding rotation pattern compliance penalties...
  ✓ No rotation violations detected

[build_model] Setting objective: Multi-level optimization
  PRIORITY 1: Minimize unassigned slots (1,000,000×)
  PRIORITY 2: Minimize employee count (100,000×)
  PRIORITY 3: Minimize soft penalties (1,000×)
    - Rotation violations
    - Anchor offset penalties
  PRIORITY 4: Maximize assignments (1×)
  ✓ Objective configured with multi-term optimization

[C1] Daily Gross Hours Constraint (HARD - by Scheme)
     Total employees: 6
     Total slots: 60
     Unique shifts: 2
     Scheme limits: A≤14h, B≤13h, P≤9.0h
     ✓ Added 0 per-shift scheme violations blocks

[C2] DEBUG: Pattern lengths: min=6, max=6
[C2] DEBUG: Work days: min=4, max=4
[C2] DEBUG: Sample patterns: [['D', 'D', 'N', 'N', 'O', 'O'], ['D', 'D', 'N', 'N', 'O', 'O'], ['D', 'D', 'N', 'N', 'O', 'O']]
[C2] DEBUG: Sample schemes: ['P', 'P', 'P']
[C2] DEBUG: Requirement patterns available: [['D', 'D', 'N', 'N', 'O', 'O']]
[C2] DEBUG: Requirement schemes available: ['P']
[C2] Pattern-Aware Weekly & Monthly Hours Constraints (HARD)
     Employees: 6, Slots: 60
     4-day employees: 0 (11.0h normal/shift)
     5-day employees: 6 (8.8h normal/shift)
     6-day employees: 0 (8.8h normal for first 5 days, 0h for 6th)
     Monthly OT caps (Standard):
       00173519: 72h
       00173565: 72h
       00173697: 72h
       00174052: 72h
       00174056: 72h
       00174104: 72h
     ✓ Added 30 weekly normal hours constraints (HARD)
     ✓ Added 0 monthly OT hours constraints (HARD)

[C3] Maximum Consecutive Working Days Constraint (HARD)
     Employees: 6, Planning horizon: 30 days
     Max consecutive days: 12 (all employees)
     ✓ Added 108 rolling window constraints

[C4] Minimum Rest Between Shifts Constraint (HARD)
     Employees: 6, Slots: 60
     Rest requirements: 1h-1h (scheme-specific)
     Unique rest values: [1]h
     ✓ Added 180 rest period disjunctive constraints

     → Adding C5 constraints for 00173519 (Scheme Scheme P)
     → Adding C5 constraints for 00173565 (Scheme Scheme P)
     → Adding C5 constraints for 00173697 (Scheme Scheme P)
     → Adding C5 constraints for 00174052 (Scheme Scheme P)
     → Adding C5 constraints for 00174056 (Scheme Scheme P)
     → Adding C5 constraints for 00174104 (Scheme Scheme P)
[C5] Minimum Off-Days Per Week Constraint (HARD)
     Employees: 6, Planning horizon: 30 days
     Minimum off-days: ≥1 per 7-day window
     ✓ Added 144 rolling window constraints

  Warning: Could not load C6_parttimer_limits: '>=' not supported between instances of 'NoneType' and 'int'
[C7] License Validity Constraint (HARD)
     Employees: 6 (0 have licenses)
     Slots: 60 (0 require qualifications)
     Qualification Groups: 0 total (0 ALL, 0 ANY)
     Blocked Assignments: 0
     Slots: 60 (0 require qualifications)
     ✓ Added 0 license validity constraints

[C8] Provisional License (PDL) Validity Constraint (HARD)
     Total employees: 6
     Employees with PDL: 0
     ✓ Added 0 PDL expiry blocks

[C9] Gender Balance Constraint (HARD)
     Total employees: 6
     Male officers: 0, Female officers: 0
     Slots with gender requirements: 0
     ✓ Added 0 M/F filter constraints
     ✓ Added 0 Mix enforcement constraints (0 groups)

[C11] Rank/Product Type Match Constraint (HARD)
     Total employees: 6
     Employee ranks: {'ASO': 6}
     Total slots: 60
     Slot product types: {'AVSO': 60}
     Slot rankIds (OR logic): {'ASO': 60, 'AVSP': 60, 'SASS': 60}
     ✓ Added 0 rank mismatch constraints (HARD)

[C12] Team Completeness Constraint (HARD)
     Total slots: 60
     Slots with team preferences: 0
     ✓ Added 0 team membership constraints

[C15] Qualification Expiry Override Control Constraint (HARD)
     Employees: 6, Slots: 60
     ✓ Added 0 expiry override violation blocks

[C16] No Overlapping Shifts Constraint
     Total employees: 6
     Total slots: 60
[C16] No Overlapping Shifts Constraint (HARD)
     ✓ Added 0 no-overlap disjunctive constraints

[C17] Monthly OT Cap Constraint (HARD)
     Employees: 6, Slots: 60
     Standard OT cap: ≤72h per month
     APGD-D10 (APO): 6 employees with ≤112-124h cap (month-dependent)
     ✓ Added 0 monthly OT constraints

[S1] Rotation Pattern Compliance (SOFT) - registered for post-solution scoring

[S2] Employee Preferences (SOFT) - registered for post-solution scoring

[S3] Consistent Shift Start Times (SOFT) - registered for post-solution scoring

[S4] Minimize Short Rest Gaps (SOFT) - registered for post-solution scoring

[S5] Officer Continuity (SOFT) - registered for post-solution scoring

[S6] Minimize Team Changes (SOFT) - registered for post-solution scoring

[S7] Zone Preferences (SOFT) - registered for post-solution scoring

[S8] Team Size Feasibility (SOFT) - registered for post-solution scoring

[S9] Travel Slack Buffer (SOFT) - registered for post-solution scoring

[S10] Fair OT Distribution (SOFT) - registered for post-solution scoring

[S11] Public Holiday Coverage (SOFT) - registered for post-solution scoring

[S12] Allowance Optimization (SOFT) - registered for post-solution scoring

[S13] Substitute Logic (SOFT) - registered for post-solution scoring

[S14] Midmonth Insert Constraint (SOFT)
     Total employees: 6
     Published assignments: 0
     Potential new joiners: 0
     Note: S14 is a soft constraint - delta-solve handled in solver workflow

[S15] Demand Coverage Score Constraint (SOFT)
     Total employees: 6
     Total slots: 60
     Demands tracked: 1
     Total demand positions: 0
     Current assignments: 360
     Note: S15 is a soft constraint - coverage maximized via objective

[S16] Whitelist/Blacklist Constraint (SOFT)
     Total employees: 6
     Whitelisted employee-demand pairs: 0
     Blacklisted employee-demand pairs: 0
     Note: S16 is a soft constraint - whitelist enforced at model level

  Warning: Could not load S18_minimize_gaps: No module named 'context.constraints.S18_minimize_gaps'
  ✓ Loaded constraint modules

[solve] Running CP-SAT solver...
  Problem size: 60 slots × 6 employees
  Time limit: 300s (user-specified)
  Parallel search workers: 1 (adaptive)
[solve] Raw status code: 4 (OPTIMAL=4, FEASIBLE=2, INFEASIBLE=3, MODEL_INVALID=1)
[extract_assignments] Extracting assignments from solution...
  ✓ Extracted 50 assigned slots
  ✓ Extracted 10 unassigned slots
  ✓ Total: 60 entries

[generate_off_day_assignments] Creating OFF_DAY assignments...
  Employees with work assignments: 4/6
  ✓ Generated 40 OFF_DAY assignments

[solve] Solution found with 100 assignments
[calculate_scores] Computing constraint violations...
  Assigned slots: 50
  Unassigned slots: 10
  ℹ️  10 slots could not be filled without violating hard constraints
[calculate_scores] Evaluating soft constraints...
  Warning: Could not score S17_work_continuity: 'ScoreBook' object has no attribute 'add_violation'
  Warning: Could not score S3_consistent_start: ScoreBook.soft() missing 1 required positional argument: 'penalty'
  Warning: Could not score S5_officer_continuity: ScoreBook.soft() missing 1 required positional argument: 'penalty'
  ✓ Scored 14 soft constraint modules

  Hard violations: 10
  Soft penalties: 0
  Unassigned slots: 10
  Total violations recorded: 10

[solve] Status override: OPTIMAL → INFEASIBLE (hard_score=10)
[solve] Status: INFEASIBLE
================================================================================

[CLI] ✓ CP-SAT completed in 53.02s
[CLI] Status: 4
[CLI] Assignments: 100

[CLI] Building output JSON...
[CLI] ✓ Total time: 53.03s (ICPMP: 0.00s, Solve: 53.02s)
✓ Solve status: INFEASIBLE → wrote output/RST-20260113-8416C7EE_Solver_Output.json
  Assignments: 130
  Hard score: 10
  Soft score: 0
  Overall score: 10
